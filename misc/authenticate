#!/bin/sh
#
# usage: ./authenticate [host [username [password [curl args]]]]

VEOHOST=${1:-http://localhost:8070}
USERNAME=${2:-admin}
PASSWORD=${3:-password}

if [ $# -ge 1 ]; then shift; fi # drop the optional username from args
if [ $# -ge 1 ]; then shift; fi # drop the optional password from args
if [ $# -ge 1 ]; then shift; fi # drop the optional password from args

TOKEN=`curl -si $@ -H "Content-Type: application/json" -X POST -d "{
    \"username\": \"$USERNAME\",
    \"password\": \"$PASSWORD\"
}" "$VEOHOST/login" |  awk -F 'Bearer ' '/^Auth/ { print $2 }'`

if [ -z $TOKEN ]
then
	echo "Authentication failed" >&2
	exit 1
fi

echo export TOKEN=$TOKEN
echo export VEOHOST=$VEOHOST
